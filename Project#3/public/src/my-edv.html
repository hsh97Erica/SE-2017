<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script src="../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">

<link rel="import" href="../bower_components/wysiwyg-e/wysiwyg-e.html">
  <link rel="import" href="../bower_components/wysiwyg-e/tools/bold.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/italic.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/underline.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/strike.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/color.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/clear.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/code.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/link.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/image.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/audio.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/video.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/ordered.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/unordered.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/indent.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/outdent.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/justify.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/heading.html">
		<link rel="import" href="../bower_components/wysiwyg-e/tools/blockquote.html">
<script src="../bower_components/webcomponentsjs/webcomponents-loader.js"></script>
<link rel="import" href="../bower_components/marked-element/marked-import.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<dom-module id="edit-view" is="dom-bind">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>
    <style>
  paper-input {
    max-width: 400px;
    margin: auto;
  }
  iron-icon, div[suffix] {
    color: hsl(0, 0%, 50%);
    margin-right: 12px;
  }
  polymer-quill.full {
    --polymer-quill-editor-max-height: 300px;
    --polymer-quill-editor-min-height: 100px;
  }
</style>
<paper-card style="width:100%; height:auto;">
   <iron-ajax id="xhr" url="/[[userid]]/querydata.json" handle-as="json" on-response="handleResponse"></iron-ajax>
     <center style="width:99%"><paper-input style="width:100%" value="{{title}}" id="titleinput" label="제목"></paper-input></center>
     <iron-ajax id="xhrpost" content-type="application/json" url="/memotransac/[[userid]]/mtut.json" method="POST" handle-as="json" on-response="handlePostResponse"></iron-ajax>
    
    <wysiwyg-e style="width: 100%; height: 100vh;" id="wysiwygE" value={{contentdata}}>
    <wysiwyg-tool-bold></wysiwyg-tool-bold>
    <wysiwyg-tool-italic></wysiwyg-tool-italic>
    <wysiwyg-tool-underline></wysiwyg-tool-underline>
    <wysiwyg-tool-strike></wysiwyg-tool-strike>
    <wysiwyg-tool-clear></wysiwyg-tool-clear>
    <wysiwyg-tool-code></wysiwyg-tool-code>
    <wysiwyg-tool-link></wysiwyg-tool-link>
    <wysiwyg-tool-image></wysiwyg-tool-image>
    <wysiwyg-tool-audio></wysiwyg-tool-audio>
    <wysiwyg-tool-video></wysiwyg-tool-video>
    <wysiwyg-tool-ordered></wysiwyg-tool-ordered>
    <wysiwyg-tool-unordered></wysiwyg-tool-unordered>
    <wysiwyg-tool-indent></wysiwyg-tool-indent>
    <wysiwyg-tool-outdent></wysiwyg-tool-outdent>
    <wysiwyg-tool-justify right center full></wysiwyg-tool-justify>
    <wysiwyg-tool-heading h1 h2 h3 h4 h5 h6></wysiwyg-tool-heading>
    <wysiwyg-tool-blockquote></wysiwyg-tool-blockquote>
    <wysiwyg-tool-undo></wysiwyg-tool-undo>
    <wysiwyg-tool-redo></wysiwyg-tool-redo>
</wysiwyg-e>
<paper-button id="savebtn" on-click="_save">저장</paper-button>
</paper-card>
</template>

  <script>
    Polymer({
      is: 'edit-view',
     properties:{
       contentdata:{
         type:String,
         notify:true,
         readOnly:false,
         value:''
       },
       userid:{
         type:String,
         value:''
       },
       boardnumber:{
         type:Number,
         value:0,
         observer: '_onboardnumberschanged',
       },
       title:{
         type:String,
         value:'',
       },
       editormode:{
        type:Number,
        value:0,
        notify:true,
        readOnly:false,
        observer: '_oneditmodechanged',
       },
     },
     _onboardnumberschanged:function(){
      // alert("call _onboardnumberschanged");
       var pid = this.boardnumber;
       this.$.xhr.params={postid:pid};
      this.$.xhr.generateRequest();
     },
     handleResponse:function(data){
        const resp = data.detail.response;
        alert(JSON.stringify(resp));
        this.contentdata = resp.data[0].memodata;
        this.title = resp.data[0].title;
        //alert("contentdata: "+this.contentdata);
        //this.$.wysiwygE.value=this.contentdata;
      },
        handlePostResponse:function(data){
        const resp = data.detail.response;
       // alert(JSON.stringify(resp));
       if(this.editormode==1){

       }
        //alert(JSON.stringify(this.$.xhrpost.body));
        this.fire("memolistviewrefresh");
        //alert("contentdata: "+this.contentdata);
        //this.$.wysiwygE.value=this.contentdata;
      },
      _oneditmodechanged:function(){
       // alert("mode change call" + this.editormode);
        if(this.editormode==2){//edit existed memo
          this.$.titleinput.readonly=false;
          this.$.savebtn.disabled=false;
          this.$.wysiwygE.mode = "edit";
        }else if(this.editormode==3){//view existed memo
          
          this.$.titleinput.readonly=true;
          this.$.savebtn.disabled=true;
          this.$.wysiwygE.mode = "read";
        }
        else{
          this.boardnumber=-1;
          this.title = '';
          this.contentdata='';
          this.$.savebtn.disabled=false;
          this.$.titleinput.readonly=false;
          this.$.wysiwygE.mode = "edit";
        }
      },
      _save:function(){
        alert("call _save");
       var pid = this.boardnumber;
       var htmlvalue = this.$.wysiwygE.value;
       var mtitle = this.title;
       var params = {postid:pid,boardpw:'',mdt:htmlvalue,title:mtitle};
       this.$.xhrpost.body=params;

      this.$.xhrpost.generateRequest();
      }
    });
  </script>
</dom-module>
